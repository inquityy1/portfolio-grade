#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint check first (this will fail if there are unfixable errors)
echo "ðŸ” Running lint check..."
npm run lint

# Check code formatting
echo "ðŸŽ¨ Checking code formatting..."
npm run format:check

# Run tests for changed files
echo "ðŸ§ª Running affected tests..."
npm run test:affected

# Only run integration tests if API files changed
if git diff --cached --name-only | grep -E "^(apps/api|packages)" > /dev/null; then
  echo "ðŸ”— API files changed, running integration tests..."
  npm run test:integration
fi

# Only run e2e tests if frontend files changed
if git diff --cached --name-only | grep -E "^(apps/(admin|portal)|packages)" > /dev/null; then
  echo "ðŸŽ­ Frontend files changed, running e2e tests..."
  npm run e2e:test
fi

echo "âœ… All checks passed! Proceeding with commit..."